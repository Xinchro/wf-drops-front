!function(e){var t={};function s(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},s.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t){let s=0,a=10,i=new Worker("searchSections.js");new Vue({el:"#vue-wrapper",data:{filters:[],menuVisible:!1,dropdata:{},filteredData:{},renderedData:{},searchText:"",busy:!1,titleDrops:{},showTitleDrops:!1,crumbs:[],typingTimeout:{},usedBreadcrumb:!1,gaLoaded:!1},watch:{},methods:{start(){window.onpopstate=(()=>{this.loadParams(),this.gotoCrumb(this.crumbs.length-2)||(this.searchText=this.crumbs[0],this.crumbs=[],this.addCrumb(this.searchText),this.setQueryParam("q",this.searchText))}),this.genFilters().then(this.setFilters(this.arrayFromString(this.doLocalStorage("get","filters")))).then(()=>{this.loadParams(),this.updateCurrentFilters()}),this.setTheme(this.doLocalStorage("get","theme")),ga(()=>{ga("create","UA-52457968-4","auto"),ga("send","pageview")})},getData:e=>new Promise((t,s)=>{if(e){const a=new XMLHttpRequest;a.onreadystatechange=(()=>{4==a.readyState&&200==a.status?t(JSON.parse(a.responseText)):404==a.status&&(s(e),console.error(`Could not get ${e}. Tweet @xinchronize this error and tell him he's bad at Javascript.`))}),a.open("GET",`https://wf-drops-data.xinchronize.com/${e}.json?=${new Date((new Date).getTime()).toLocaleString()}`,!0),a.send(null)}else s("No name to fetch.")}),getDataList(e){let t=[];return new Promise((e,s)=>{let a=this.filters,i=this.getData;!function s(r){let o=a[r];i(o.on?o.name:"").then(i=>{o.on&&i.sections.forEach(e=>{t.push(e)}),++r<a.length?s(r):e({sections:t})},i=>{console.error(`${i} - Rejected`),++r<a.length?s(r):e({sections:t})})}(0)})},updateSearchResults(){this.$set(this.filteredData,"sections",{}),this.getDataList(this.filters).then(e=>{this.updateData(e)})},searchBar(e){clearTimeout(this.typingTimeout),this.typingTimeout=setTimeout(()=>{this.search(e),this.gaEvent("search","input",`bar - ${e||"blank"}`)},500)},searchItem(e){this.searchText=e,this.search(e),this.gaEvent("search","click",`item - ${e||"blank"}`)},searchTitle(e){let t=this.stripRelicText(e).text,s=this.stripRelicText(e).isRelic;"Nothing related"!=t&&(this.searchText=t,this.search(t)),this.gaEvent("search","click",`title - ${s?"relic - ":""}${t||"blank"}`)},searchRelated(e){let t=this.stripRelicText(e).text,s=this.stripRelicText(e).isRelic;"Nothing related"!=t&&(this.searchText=t,this.search(t)),this.gaEvent("search","click",`related - ${s?"relic - ":""}${t||"blank"}`)},stripRelicText(e){let t=!1;return["(Intact)","(Exceptional)","(Flawless)","(Radiant)"].forEach(s=>{e.toLowerCase().includes(s.toLowerCase())&&(e=e.replace(s,"").toLowerCase(),t=!0)}),{text:e,isRelic:t}},search(e){let t=e.split(" ");s=0,a=10,this.filteredData.sections||(this.$set(this.filteredData,"sections",[]),this.addHead()),this.dropdata.sections?(i.postMessage([this.dropdata.sections,t]),i.onmessage=(e=>{this.$set(this.filteredData,"sections",e.data),this.addHead()})):(this.$set(this.filteredData,"sections",this.dropdata),this.addHead()),this.setQueryParam("q",this.searchText),this.usedBreadcrumb||this.addCrumb(this.searchText),this.setDocumentTitle(this.searchText),this.usedBreadcrumb=!1},updateData(e){this.$set(this,"dropdata",e),this.search(this.searchText)},toggleMenu(){this.menuVisible=!this.menuVisible},checkbox:e=>document.getElementById(e),updateCurrentFilters(e){void 0!=e&&(this.filters[e].on=this.checkbox(e).checked=!this.checkbox(e).checked,this.gaEvent("toggleFilter","click",this.filters[e].name)),s=0,a=10,this.updateSearchResults();let t=this.getCurrentFiltersString();this.setQueryParam("filters",t),this.doLocalStorage("set","filters",t)},getCurrentFiltersString(){let e="";return this.filters.forEach(t=>{t.on&&(e+=`${t.id},`)}),e=e.slice(0,-1)},addHead(){if(this.renderedData={sections:[]},this.filteredData.sections&&this.filteredData.sections.length>0){for(let e=0;e<a;e++)this.filteredData.sections[e]&&this.renderedData.sections.push(this.filteredData.sections[e]);this.filteredData.sections.length>0&&(a+5>this.filteredData.sections.length?a=this.filteredData.sections.length:(s=a,a+=5))}this.$set(this,"renderedData",this.renderedData)},setTheme(e){let t=document.getElementById("vue-wrapper");return t.className=e,"dark"===e&&(t.className=""),this.doLocalStorage("set","theme",e),e},resetRelated(e){this.getScrollerElement(e).className+=" invisible"},getScrollerElement:e=>document.getElementById(`${e}-title-drop-scroller`),toggleRelated(e){this.getScrollerElement(e).className.includes("invisible")?this.updateRelated(e):this.resetRelated(e),this.gaEvent("toggleRelated","click",e)},updateRelated(e){let t=[],s=this.getScrollerElement(e),a=e.replace("","").toLowerCase();this.$set(this.titleDrops,"data",""),["(Intact)","(Exceptional)","(Flawless)","(Radiant)"].forEach(t=>{e.toLowerCase().includes(t.toLowerCase())&&(e=e.replace(t,"").toLowerCase())}),e=e.split(" "),i.postMessage([this.dropdata.sections,e]),i.onmessage=(e=>{e.data.forEach(e=>{e.section.toLowerCase().includes(a.toLowerCase())||t.push(e.section)}),t.length>0?this.$set(this.titleDrops,"data",t):this.$set(this.titleDrops,"data",["Nothing related"]),setTimeout(()=>{s.className=s.className.replace(/ invisible/g,""),t.length>0?s.children[1].children[0].style.animationDuration=`${s.offsetWidth/10}s`:s.children[1].children[0].style.animationDuration="0s"},10)})},getQueryParams(){let e="",t=[];return(e=window.location.search.split("?")[1])&&(e=e.split("&")).forEach(e=>{let s={key:e.split("=")[0],value:e.split("=")[1]};s.value=decodeURIComponent(s.value),e.split("=")[1].includes(",")&&(s.value=this.arrayFromString(s.value)),t.push(s)}),t},arrayFromString(e){if(void 0!=e&&""!=e){let t=e.split(",");return t.forEach((e,s)=>{t[s]=parseInt(e)}),t}{let e=[];return this.filters.forEach((t,s)=>{e.push(s+1)}),e}},setQueryParam(e,t){let s="/?",a=this.getQueryParams(),i=!1;if(a.forEach(s=>{e===s.key&&(s.value=t,i=!0)}),i||a.push({key:e,value:t}),a.forEach((e,t)=>{t>0&&(s+="&"),s+=`${e.key}=${e.value}`}),history.pushState){let e={},t=this.searchText,a=`${s}`;history.pushState(e,t,a)}},loadParams(){this.getQueryParams().forEach(e=>{switch(e.key){case"q":this.searchText=e.value;break;case"filters":this.setFilters(e.value);break;default:console.error(`${e.key} is not a valid param`)}})},genFilters(){return this.getData("index").then(e=>{const t=e.endpoints;this.filters=t.map((e,t)=>({name:e.name.replace(".json",""),label:e.displayName,id:t,on:!0}))})},setFilters(e){return new Promise((t,s)=>{"object"==typeof e&&(this.filters.forEach(e=>{e.on=!1}),e.forEach(e=>{"number"!=typeof e||isNaN(e)||this.filters[e]&&(this.filters[e].on=!0)})),t()})},addCrumb(e){""!=e&&this.crumbs.push(e)},gotoCrumb(e){return this.usedBreadcrumb=!0,this.crumbs.length>0&&this.crumbs.length-Math.abs(e)>0&&this.crumbs.slice(0,e).length>=0&&(this.searchText=this.crumbs[e],this.crumbs=this.crumbs.slice(0,e+1),this.setQueryParam("q",this.searchText),!0)},setDocumentTitle(e){document.title=`${e} - Warframe Drops`},doLocalStorage(e,t,s){try{switch(e.toLowerCase()){case"set":return window.localStorage.setItem(t,s);case"get":if(window.localStorage.getItem(t))return window.localStorage.getItem(t);break;case"remove":return window.localStorage.removeItem(t);default:console.error("local storage supported, but no action type specified")}}catch(e){console.error("Local storage not supported!"),console.error(e)}},gaEvent(e,t,s){if(this.gaLoaded){if(void 0==e||""==e||void 0==t||""==t)return void console.error("failed to send ga event",e,t,s);void 0!=s&&""!=s||console.warn("no label set for this ga event",e,t,s),ga(()=>{ga("set","dimension1",this.getCurrentFiltersString()),ga("send","event",e,t,s)})}else ga(()=>{this.gaLoaded=!0,this.gaEvent(e,t,s)})}}}).start(),Vue.use(infiniteScroll)}]);